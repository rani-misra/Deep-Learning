
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentiment Analysis App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        select, button {
            padding: 10px;
            font-size: 16px;
            margin-top: 10px;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
        }
        table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>

    <h1>Sentiment Analysis App</h1>

    <!-- Dropdown to select a restaurant -->
    <label for="restaurantDropdown">Select a restaurant:</label>
    <select id="restaurantDropdown">
        <option value="">Loading...</option>
    </select>

    <!-- Display general sentiment score -->
    <div id="generalSentiment" class="result"></div>

    <!-- Display results in a table -->
    <div class="result">
        <table>
            <thead>
                <tr>
                    <th>Text</th>
                    <th>Predicted Sentiment</th>
                </tr>
            </thead>
            <tbody id="sentimentText"></tbody>
        </table>
    </div>

    <script>
        // Function to load the JSON data and populate the dropdown
        fetch('https://raw.githubusercontent.com/rani-misra/Deep-Learning/refs/heads/main/test_data.json') // Assuming the JSON file is hosted locally
            .then(response => response.json())
            .then(data => {
                // Populate the dropdown with restaurant names
                const dropdown = document.getElementById("restaurantDropdown");
                dropdown.innerHTML = "<option value=''>Select a restaurant</option>"; // Reset dropdown

                const restaurantNames = [...new Set(data.map(item => item.name))]; // Get unique restaurant names
                
                // Sort the restaurant names alphabetically
                restaurantNames.sort((a, b) => a.localeCompare(b));

                restaurantNames.forEach((name) => {
                    const option = document.createElement("option");
                    option.value = name;
                    option.textContent = name;
                    dropdown.appendChild(option);
                });

                // Add event listener to handle dropdown selection
                dropdown.addEventListener("change", function() {
                    const selectedRestaurant = dropdown.value;
                    if (selectedRestaurant) {
                        // Filter the data based on the selected restaurant
                        const filteredData = data.filter(item => item.name === selectedRestaurant);

                        // Debugging the data and checking for missing or incorrect values
                        console.log('Filtered Data:', filteredData);

                        // Mapping sentiment text to numerical values
                        const sentimentMap = {
                            "Negative": 0,
                            "Neutral": 1,
                            "Positive": 2
                        };

                        // Calculate average sentiment
                        const avgSentiment = filteredData.reduce((acc, item) => {
                            const sentiment = item.predicted_text;
                            // If predicted_text is valid, use the mapped numeric value
                            return acc + (sentimentMap[sentiment] !== undefined ? sentimentMap[sentiment] : 0);
                        }, 0) / filteredData.length;

                        const rounded = Math.round(avgSentiment);
                        const generalSentiment = Object.keys(sentimentMap).find(key => sentimentMap[key] === rounded) || "Unknown";

                        // Log the average sentiment calculation
                        console.log('Average Sentiment:', avgSentiment);

                        document.getElementById("generalSentiment").innerText = `ðŸ“Š General Sentiment: ${generalSentiment} (Average score: ${avgSentiment.toFixed(2)})`;

                        // Show the first 5 entries of text and predicted sentiment in a table
                        const sentimentText = filteredData.slice(0, 5).map(item => {
                            return `
                                <tr>
                                    <td>${item.text}</td>
                                    <td>${item.predicted_text}</td>
                                </tr>
                            `;
                        }).join('');

                        document.getElementById("sentimentText").innerHTML = sentimentText;
                    } else {
                        document.getElementById("generalSentiment").innerText = '';
                        document.getElementById("sentimentText").innerHTML = '';
                    }
                });
            })
            .catch(error => console.error('Error fetching JSON:', error));
    </script>

</body>
</html>

